"use strict";(self.webpackChunkcatenax_ng=self.webpackChunkcatenax_ng||[]).push([[4532],{3905:function(e,t,a){a.d(t,{Zo:function(){return s},kt:function(){return m}});var n=a(7294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var u=n.createContext({}),p=function(e){var t=n.useContext(u),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},s=function(e){var t=p(e.components);return n.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,r=e.originalType,u=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),d=p(a),m=l,h=d["".concat(u,".").concat(m)]||d[m]||c[m]||r;return a?n.createElement(h,o(o({ref:t},s),{},{components:a})):n.createElement(h,o({ref:t},s))}));function m(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=a.length,o=new Array(r);o[0]=d;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var p=2;p<r;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},1652:function(e,t,a){a.r(t),a.d(t,{assets:function(){return s},contentTitle:function(){return u},default:function(){return m},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return c}});var n=a(7462),l=a(3366),r=(a(7294),a(3905)),o=["components"],i={title:"How To Use Vault Secrets With ArgoCD"},u=void 0,p={unversionedId:"guides/howto-use-vault-secrets-with-argocd",id:"guides/howto-use-vault-secrets-with-argocd",title:"How To Use Vault Secrets With ArgoCD",description:"This guide is a small howto about using secrets stored in HashiCorp Vault with your ArgoCD applications (with Helm",source:"@site/docs/guides/howto-use-vault-secrets-with-argocd.md",sourceDirName:"guides",slug:"/guides/howto-use-vault-secrets-with-argocd",permalink:"/docs/guides/howto-use-vault-secrets-with-argocd",editUrl:"https://github.com/catenax-ng/catenax-ng.github.io/edit/main/docs/guides/howto-use-vault-secrets-with-argocd.md",tags:[],version:"current",frontMatter:{title:"How To Use Vault Secrets With ArgoCD"},sidebar:"tutorialSidebar",previous:{title:"How To Use HashiCorp Vault",permalink:"/docs/guides/how-to-use-vault"},next:{title:"Internal Guides",permalink:"/docs/internal"}},s={},c=[{value:"Add Placeholder To Your Code",id:"add-placeholder-to-your-code",level:2},{value:"Examples",id:"examples",level:3},{value:"Configure The ArgoCD App To Use AVP",id:"configure-the-argocd-app-to-use-avp",level:2},{value:"Available ArgoCD Vault Plugins",id:"available-argocd-vault-plugins",level:2},{value:"<em>argocd-vault-plugin</em>",id:"argocd-vault-plugin",level:3},{value:"<em>argocd-vault-plugin-helm</em>",id:"argocd-vault-plugin-helm",level:3},{value:"<em>argocd-vault-plugin-kustomize</em>",id:"argocd-vault-plugin-kustomize",level:3}],d={toc:c};function m(e){var t=e.components,a=(0,l.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This guide is a small howto about using secrets stored in HashiCorp Vault with your ArgoCD applications (with Helm\ncharts or Kustomize)."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"tl;dr")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"To use vault secrets with your ArgoCD app, you have to"),(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"store your secret inside your Vault tenant"),(0,r.kt)("li",{parentName:"ul"},"insert placeholders to app dependend files (ArgoCD App, helm, kustomize, etc.)"),(0,r.kt)("li",{parentName:"ul"},"configure your ArgoCD application to use an ArgoCD Vault Plugin (AVP) using the ",(0,r.kt)("em",{parentName:"li"},"vault-secret"))),(0,r.kt)("p",{parentName:"div"},"For guidance of how to use Vault and store a secret inside Vault, please refer to\n",(0,r.kt)("a",{parentName:"p",href:"/docs/guides/how-to-use-vault"},"How To Use Vault"),"."))),(0,r.kt)("h2",{id:"add-placeholder-to-your-code"},"Add Placeholder To Your Code"),(0,r.kt)("p",null,"The AVP plugin use placeholders to recognize where you want to place a Vault secret value inside your code. Example\nplaceholder:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<placeholder>")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<path:some/path#secret-key>")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"<path:some/path#secret-key#version>"))),(0,r.kt)("p",null,"The secret path can alternatively be defined as annotation in manifest files instead of inside the placeholder."),(0,r.kt)("h3",{id:"examples"},"Examples"),(0,r.kt)("p",null,"Placeholder inside manifest file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Secret\nmetadata:\n  name: avp-example-secret\ntype: Opaque\nstringData:\n  foo: <path:product-team-example/data/hello#foo>\n")),(0,r.kt)("p",null,"Placeholder with annotation inside manifest file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Secret\nmetadata:\n  name: avp-example-secret\n  annotations:\n    avp.kubernetes.io/path: "product-team-example/data/hello"\ntype: Opaque\nstringData:\n  foo: <foo>\n')),(0,r.kt)("p",null,"When using annotation to specify the path to the secret inside vault, the placeholder represents only the key inside the\nsecret."),(0,r.kt)("p",null,"You are not limited to use these placeholders inside manifest files, you can also use these inside helm specific file\nlike ",(0,r.kt)("inlineCode",{parentName:"p"},"values.yaml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"avp:\n  helm:\n    secretPath: <path:product-team-example/data/hello#foo>\n")),(0,r.kt)("p",null,"And inside e.g. the helm templates you can reference like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Secret\nmetadata:\n  name: avp-example-path-secret\ntype: Opaque\nstringData:\n  foo: { { .Values.avp.helm.secretPath } }\n")),(0,r.kt)("p",null,"For more details about placeholders, please refer\nto ",(0,r.kt)("a",{parentName:"p",href:"https://argocd-vault-plugin.readthedocs.io/en/stable/howitworks/#types-of-placeholders"},"ArgoCD Vault Plugin Docu"),"."),(0,r.kt)("h2",{id:"configure-the-argocd-app-to-use-avp"},"Configure The ArgoCD App To Use AVP"),(0,r.kt)("p",null,"To enable your ArgoCD app to use the AVP plugin there are two mandatory steps required:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Configure the app to use one of the availabl AVP plugins"),(0,r.kt)("li",{parentName:"ul"},"Provide an environment variable ",(0,r.kt)("em",{parentName:"li"},"AVP_Secret")," to the plugin with ",(0,r.kt)("em",{parentName:"li"},"vault-secret")," as value")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Your Vault Secret")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The ",(0,r.kt)("em",{parentName:"p"},"vault-secret")," has been created for each product-team during onboarding."))),(0,r.kt)("p",null,"In general your ArgoCD app manifest should look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: my-argo-app\nspec:\n  project: project-name\n  destination:\n    server: https://kubernetes.default.svc\n    namespace: project-name\n  source:\n    repoURL: https://github.com/catenax-ng/someRepo/\n    targetRevision: HEAD\n    path: path/to/app\n    // highlight-start\n    plugin:\n      name: argocd-vault-plugin\n      env:\n        - name: AVP_SECRET\n          value: vault-secret\n    // highlight-end\n")),(0,r.kt)("h2",{id:"available-argocd-vault-plugins"},"Available ArgoCD Vault Plugins"),(0,r.kt)("p",null,"For different approaches there are different ArgoCD Vault Plugins (AVP) available:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"argocd-vault-plugin")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"argocd-vault-plugin-helm")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"argocd-vault-plugin-kustomize"))),(0,r.kt)("h3",{id:"argocd-vault-plugin"},(0,r.kt)("em",{parentName:"h3"},"argocd-vault-plugin")),(0,r.kt)("p",null,"Use this AVP plugin when your ArgoCD app is based on plain kubernetes manifest files, and you want to pull secrets from\nvault into your app."),(0,r.kt)("p",null,"The App manifest should contain:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"  plugin:\n    //highlight-next-line\n    name: argocd-vault-plugin\n    env:\n      - name: AVP_SECRET\n        value: vault-secret\n")),(0,r.kt)("h3",{id:"argocd-vault-plugin-helm"},(0,r.kt)("em",{parentName:"h3"},"argocd-vault-plugin-helm")),(0,r.kt)("p",null,"Use this AVP plugin when your ArgoCD app is based on helm charts, and you want to pull secrets from vault into your app."),(0,r.kt)("p",null,"The App manifest should contain:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"  plugin:\n    //highlight-next-line\n    name: argocd-vault-plugin-helm\n    env:\n      - name: AVP_SECRET\n        value: vault-secret\n")),(0,r.kt)("h3",{id:"argocd-vault-plugin-kustomize"},(0,r.kt)("em",{parentName:"h3"},"argocd-vault-plugin-kustomize")),(0,r.kt)("p",null,"Use this AVP plugin when your ArgoCD app is based on plain kubernetes manifest files, and you want to pull secrets from\nvault into your app."),(0,r.kt)("p",null,"The App manifest should contain:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"  plugin:\n    //highlight-next-line\n    name: argocd-vault-plugin-kustomize\n    env:\n      - name: AVP_SECRET\n        value: vault-secret\n")))}m.isMDXComponent=!0}}]);