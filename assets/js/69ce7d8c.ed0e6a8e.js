"use strict";(self.webpackChunkcatenax_ng=self.webpackChunkcatenax_ng||[]).push([[7561],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return h}});var o=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,o,n=function(e,t){if(null==e)return{};var a,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)a=i[o],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)a=i[o],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var u=o.createContext({}),s=function(e){var t=o.useContext(u),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=s(e.components);return o.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,u=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),d=s(a),h=n,g=d["".concat(u,".").concat(h)]||d[h]||p[h]||i;return a?o.createElement(g,l(l({ref:t},c),{},{components:a})):o.createElement(g,l({ref:t},c))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,l=new Array(i);l[0]=d;var r={};for(var u in t)hasOwnProperty.call(t,u)&&(r[u]=t[u]);r.originalType=e,r.mdxType="string"==typeof e?e:n,l[1]=r;for(var s=2;s<i;s++)l[s]=a[s];return o.createElement.apply(null,l)}return o.createElement.apply(null,a)}d.displayName="MDXCreateElement"},295:function(e,t,a){a.r(t),a.d(t,{assets:function(){return c},contentTitle:function(){return u},default:function(){return h},frontMatter:function(){return r},metadata:function(){return s},toc:function(){return p}});var o=a(7462),n=a(3366),i=(a(7294),a(3905)),l=["components"],r={title:"How To Use HashiCorp Vault"},u=void 0,s={unversionedId:"guides/how-to-use-vault",id:"guides/how-to-use-vault",title:"How To Use HashiCorp Vault",description:"This guide is a small howto about storing your secrets using HashiCorp Vault. Following prerequisites have to be met:",source:"@site/docs/guides/how-to-use-vault.md",sourceDirName:"guides",slug:"/guides/how-to-use-vault",permalink:"/docs/guides/how-to-use-vault",draft:!1,editUrl:"https://github.com/catenax-ng/catenax-ng.github.io/edit/main/docs/guides/how-to-use-vault.md",tags:[],version:"current",frontMatter:{title:"How To Use HashiCorp Vault"},sidebar:"tutorialSidebar",previous:{title:"How to use Two-Factor Authentication (2FA) with GitHub.com",permalink:"/docs/guides/how-to-use-2fa-with-github"},next:{title:"How To Use Vault Secrets With ArgoCD",permalink:"/docs/guides/howto-use-vault-secrets-with-argocd"}},c={},p=[{value:"Login",id:"login",level:2},{value:"Login via OIDC (preferred method)",id:"login-via-oidc-preferred-method",level:3},{value:"Login to web UI via OIDC",id:"login-to-web-ui-via-oidc",level:4},{value:"Login to vault CLI via OIDC",id:"login-to-vault-cli-via-oidc",level:4},{value:"Troubleshooting OIDC login",id:"troubleshooting-oidc-login",level:4},{value:"Login via GitHub PAT",id:"login-via-github-pat",level:3},{value:"Create GitHub Token",id:"create-github-token",level:4},{value:"Login to web UI via GitHub PAT",id:"login-to-web-ui-via-github-pat",level:4},{value:"Login with vault CLI via GitHub PAT",id:"login-with-vault-cli-via-github-pat",level:4},{value:"Login via vault token",id:"login-via-vault-token",level:3},{value:"Create a Vault token",id:"create-a-vault-token",level:4},{value:"Login to web UI via Vault token",id:"login-to-web-ui-via-vault-token",level:4},{value:"Login with vault CLI via Vault token",id:"login-with-vault-cli-via-vault-token",level:4},{value:"Create A Secret",id:"create-a-secret",level:2},{value:"Vault WebUI",id:"vault-webui",level:3},{value:"Vault Cli",id:"vault-cli",level:3},{value:"Read A Secret",id:"read-a-secret",level:2},{value:"Vault WebUI",id:"vault-webui-1",level:3},{value:"Vault CLI",id:"vault-cli-1",level:3},{value:"See Also",id:"see-also",level:2}],d={toc:p};function h(e){var t=e.components,r=(0,n.Z)(e,l);return(0,i.kt)("wrapper",(0,o.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This guide is a small howto about storing your secrets using HashiCorp Vault. Following prerequisites have to be met:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"your product-team must have been onboarded to Catena-X NG GitHub organization")),(0,i.kt)("p",null,"For guidance of how to use secret with an ArgoCD application, please refer to\n",(0,i.kt)("a",{parentName:"p",href:"/docs/guides/howto-use-vault-secrets-with-argocd"},(0,i.kt)("em",{parentName:"a"},"How To Use Vault Secrets With ArgoCD")),"."),(0,i.kt)("p",null,"The Catena-X Vault instance URL is: ",(0,i.kt)("a",{parentName:"p",href:"https://vault.demo.catena-x.net"},"https://vault.demo.catena-x.net")),(0,i.kt)("h2",{id:"login"},"Login"),(0,i.kt)("p",null,"There are multiple ways to login to Vault. The following sections describe the differences and how to use these methods."),(0,i.kt)("h3",{id:"login-via-oidc-preferred-method"},"Login via OIDC (preferred method)"),(0,i.kt)("p",null,"OIDC is the preferred login method for Vault, since you do not need to create additional credentials for our tooling.\nInstead, we configured OIDC to authenticate your user via GitHub login. As advantage over the GitHub token login method,\nyou do not need to create a personal access token."),(0,i.kt)("h4",{id:"login-to-web-ui-via-oidc"},"Login to web UI via OIDC"),(0,i.kt)("p",null,"If you want to edit or view secrets via Vaults ",(0,i.kt)("a",{parentName:"p",href:"https://vault.demo.catena-x.net"},"web UI"),", you are not logged in yet and\nwant to do that via OIDC, you can select the OIDC login method like shown in the following screenshot."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Vault login method OIDC",src:a(1196).Z,width:"1330",height:"706"})),(0,i.kt)("p",null,"Unfortunately, Vault does not automatically match your GitHub team to your linked policies. Therefore, you need to\nspecify your team name (i.e. 'product-team-example') as 'Role', when logging in."),(0,i.kt)("p",null,"After you hit the 'Sign in' button, a PopUp will appear asking you about access permissions to your GitHub profile\ninformation, like you know it from different OIDC logins. Accepting that will log you in and redirect you to the\navailable secret engines."),(0,i.kt)("h4",{id:"login-to-vault-cli-via-oidc"},"Login to vault CLI via OIDC"),(0,i.kt)("p",null,"You can also use OIDC as login method for the ",(0,i.kt)("a",{parentName:"p",href:"https://www.vaultproject.io/downloads"},"Vault CLI"),". The login then needs a\nlocal port on your machine, that it can use for a browser redirect and the role you want to log in as parameters. The\nport you need to use is '8250', since it is the only one configured as allowed redirect port. Adapt the following\nsnippet to your needs to log in to Vault via CLI with the OIDC method:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'export VAULT_ADDR="https://vault.demo.catena-x.net:443"\nvault login -method=oidc port=8250 role=<my-github-team-name>\n')),(0,i.kt)("p",null,"This will pop up a new browser window, where you need to grant access to your GitHub profile information."),(0,i.kt)("h4",{id:"troubleshooting-oidc-login"},"Troubleshooting OIDC login"),(0,i.kt)("p",null,"There are some minor issues, that could prevent you from successfully logging in to Vault via OIDC. Here is a short list\nof things you can try, if nothing happens on the OIDC login page:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Manually click sign in -> The web UI does not respond to the 'Enter' key"),(0,i.kt)("li",{parentName:"ul"},"You've misspelled your team name -> Vault won't show you an error on the UI if the role you specified does not exist")),(0,i.kt)("p",null,"If you checked the mentioned things and still cannot sign in, feel free to open a support ticket, or contact us via\nCoP channel."),(0,i.kt)("h3",{id:"login-via-github-pat"},"Login via GitHub PAT"),(0,i.kt)("p",null,"This section describes, how you can use a GitHub personal access token (PAT) to log in to Vault."),(0,i.kt)("h4",{id:"create-github-token"},"Create GitHub Token"),(0,i.kt)("p",null,"To be able to use GitHub Token as login method with Vault you have to create a personal token with appropriate\npermissions granted. To create a personalized token:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"navigate to the Developer settings on\nGitHub ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/settings/tokens"},"Settings / Developer settings / Personal access tokens"),"."),(0,i.kt)("li",{parentName:"ul"},"click on ",(0,i.kt)("em",{parentName:"li"},"Generate new token")," in the upper right corner"),(0,i.kt)("li",{parentName:"ul"},"add a ",(0,i.kt)("em",{parentName:"li"},"Note")," that fits your needs (this helps you to identify the intent of the token later)"),(0,i.kt)("li",{parentName:"ul"},"select an ",(0,i.kt)("em",{parentName:"li"},"Expiration")," date"),(0,i.kt)("li",{parentName:"ul"},"grant ",(0,i.kt)("a",{parentName:"li",href:"https://www.vaultproject.io/docs/auth/github"},(0,i.kt)("em",{parentName:"a"},"read:org"))," permissions to your token"),(0,i.kt)("li",{parentName:"ul"},"click on ",(0,i.kt)("em",{parentName:"li"},"Generate token")," at the bottom of the form.")),(0,i.kt)("p",null,"After these steps GitHub will show you the token."),(0,i.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"GitHub will show the token ",(0,i.kt)("strong",{parentName:"p"},"only once")," after creation. If you miss to safe the token in any kind you'll have to\ngenerate a new token and revoke the old one for security reasons."),(0,i.kt)("p",{parentName:"div"},"We strongly suggest using a password manager like ",(0,i.kt)("a",{parentName:"p",href:"https://keepass.info"},"KeePass")," (or any other password manager) to\nstore personal sensitive data."))),(0,i.kt)("h4",{id:"login-to-web-ui-via-github-pat"},"Login to web UI via GitHub PAT"),(0,i.kt)("p",null,"If you want to edit or view secrets via Vaults ",(0,i.kt)("a",{parentName:"p",href:"https://vault.demo.catena-x.net"},"web UI"),", you are not logged in yet and\nwant to do that via GitHub PAT, you can select the github login method like shown in the following screenshot."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Vault login method OIDC",src:a(9129).Z,width:"1328",height:"709"})),(0,i.kt)("p",null,"Copy and paste your GitHub PAT from your password manager application and hit sign in. Now you will be redirected to the\navailable secret engines."),(0,i.kt)("h4",{id:"login-with-vault-cli-via-github-pat"},"Login with vault CLI via GitHub PAT"),(0,i.kt)("p",null,"You can also use the ",(0,i.kt)("a",{parentName:"p",href:"https://www.vaultproject.io/downloads"},"Vault CLI")," to manage your secrets. To log in with your CLI\nvia GitHub PAT, you'll need to execute the following commands:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'export VAULT_ADDR="https://vault.demo.catena-x.net:443"\nexport GH_TOKEN="YOUR_TOKEN"\nvault login -method=github token=$GH_TOKEN\n')),(0,i.kt)("h3",{id:"login-via-vault-token"},"Login via vault token"),(0,i.kt)("p",null,"Another login method is a token issued by Vault itself. As advantage over the GitHub PAT, the Vault token can only be\nused in Vault and not in GitHub as well (security). Also, the TTL of Vault tokens is short-lived.",(0,i.kt)("br",{parentName:"p"}),"\n","The following section shows you how to log in via Vault token that."),(0,i.kt)("h4",{id:"create-a-vault-token"},"Create a Vault token"),(0,i.kt)("p",null,"To create a token issued by Vault, you first have to be logged in via one of the other login methods. To get your login\ntoken, click ",(0,i.kt)("em",{parentName:"p"},"Copy token")," from the user menu in the top right corner of the Vault web UI, like shown in the following\nscreenshot:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Vault login method OIDC",src:a(9586).Z,width:"1327",height:"706"})),(0,i.kt)("h4",{id:"login-to-web-ui-via-vault-token"},"Login to web UI via Vault token"),(0,i.kt)("p",null,"If you want to edit or view secrets via Vaults ",(0,i.kt)("a",{parentName:"p",href:"https://vault.demo.catena-x.net"},"web UI"),", you are not logged in yet and\nwant to do that via token issued by Vault, you can select the token login method like shown in the following screenshot."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Vault login method OIDC",src:a(3726).Z,width:"1325",height:"701"})),(0,i.kt)("p",null,"Copy and paste your previously collected token and log in. You'll be redirected to your available secret engines."),(0,i.kt)("h4",{id:"login-with-vault-cli-via-vault-token"},"Login with vault CLI via Vault token"),(0,i.kt)("p",null,"You can also use the ",(0,i.kt)("a",{parentName:"p",href:"https://www.vaultproject.io/downloads"},"Vault CLI")," to manage your secrets. To log in with your CLI\nvia token issued by Vault, you'll need to execute the following steps:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'export VAULT_ADDR="https://vault.demo.catena-x.net:443"\nexport VAULT_TOKEN="YOUR_TOKEN"\nvault login -method=token token=$VAULT_TOKEN\n')),(0,i.kt)("h2",{id:"create-a-secret"},"Create A Secret"),(0,i.kt)("p",null,"After you successfully logged into Vault via one of the previously described login methods, you can create and modify\nsecrets in Vault. The following section shows you how to do that."),(0,i.kt)("h3",{id:"vault-webui"},"Vault WebUI"),(0,i.kt)("p",null,"After login to Vault, you'll have access to the Vault secret engine(s) created for your product-team."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Empty secret store",src:a(9790).Z,width:"1195",height:"510"})),(0,i.kt)("p",null,"To create a secret"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"click on ",(0,i.kt)("em",{parentName:"li"},"Create secret +")," in the upper right area"),(0,i.kt)("li",{parentName:"ul"},"enter a ",(0,i.kt)("em",{parentName:"li"},"Path for this secret"),", this will be the secret name"),(0,i.kt)("li",{parentName:"ul"},"add as many ",(0,i.kt)("em",{parentName:"li"},"Secret data")," lines, as you require to store in this secret"),(0,i.kt)("li",{parentName:"ul"},"click on the ",(0,i.kt)("em",{parentName:"li"},"Save")," button to store your first secret")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"create your first secret",src:a(2955).Z,width:"1195",height:"766"}),"\nSecret data values have been made visible for demonstration purpose. By default values aren't visible in plain text."),(0,i.kt)("p",null,"After you have created your first secret in Vault, the path is created inside your secret store and can be browsed\neasily."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Vault secret store folder structure",src:a(6209).Z,width:"1195",height:"459"})),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"We strongly suggest to organize secrets in folders based on its intention. Vault will automatically create folders, if\nyou enter a specific path."))),(0,i.kt)("h3",{id:"vault-cli"},"Vault Cli"),(0,i.kt)("p",null,"To create a secret using the CLI execute the command ",(0,i.kt)("inlineCode",{parentName:"p"},"vault kv put path/to/secret key1=value2 [key2=value2]"),", example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ vault kv put product-team-example/hello foo=bar\n========= Secret Path =========\nproduct-team-example/data/hello\n\n======= Metadata =======\nKey                Value\n---                -----\ncreated_time       2022-04-14T13:42:08.41991265Z\ncustom_metadata    <nil>\ndeletion_time      n/a\ndestroyed          false\nversion            1\n")),(0,i.kt)("h2",{id:"read-a-secret"},"Read A Secret"),(0,i.kt)("h3",{id:"vault-webui-1"},"Vault WebUI"),(0,i.kt)("p",null,"Login to Vault and browse to the secret you need, and click on the copy icon."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Copy Secret",src:a(8713).Z,width:"1195",height:"272"})),(0,i.kt)("h3",{id:"vault-cli-1"},"Vault CLI"),(0,i.kt)("p",null,"To read a secret using the CLI execute the command ",(0,i.kt)("inlineCode",{parentName:"p"},"vault kv get path/to/secret"),", example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ vault kv get product-team-example/hello\n========= Secret Path =========\nproduct-team-example/data/hello\n\n======= Metadata =======\nKey                Value\n---                -----\ncreated_time       2022-04-14T13:42:08.41991265Z\ncustom_metadata    <nil>\ndeletion_time      n/a\ndestroyed          false\nversion            1\n\n=== Data ===\nKey    Value\n---    -----\nfoo    bar\n")),(0,i.kt)("h2",{id:"see-also"},"See Also"),(0,i.kt)("p",null,"For further information about Hashicorp Vault please refer to their ",(0,i.kt)("a",{parentName:"p",href:"https://www.vaultproject.io/docs"},"documentation"),"."))}h.isMDXComponent=!0},2955:function(e,t,a){t.Z=a.p+"assets/images/vault-add-first-secret-16685febc7222089fb643567e88b6ad8.png"},8713:function(e,t,a){t.Z=a.p+"assets/images/vault-copy-secret-webui-2d612875a920c8636c90802d968e7b6b.png"},9790:function(e,t,a){t.Z=a.p+"assets/images/vault-empty-store-1625abfa0bf03ef1a97483aabc5064bf.png"},6209:function(e,t,a){t.Z=a.p+"assets/images/vault-folder-structure-e805852b8f9cb79f3aa61fb9fd0f6ae1.png"},9586:function(e,t,a){t.Z=a.p+"assets/images/vault-create-login-token-b94fcb10eacb68a44b0b8aa377474de2.png"},9129:function(e,t,a){t.Z=a.p+"assets/images/vault-login-page-github-4fb50424e45f86b69d63a8c0fae2da86.png"},1196:function(e,t,a){t.Z=a.p+"assets/images/vault-login-page-oidc-0af0c137a7c81b6b1567c8d09d9242cf.png"},3726:function(e,t,a){t.Z=a.p+"assets/images/vault-login-page-token-74c1344c800d68fc73cb28badc7a8bc9.png"}}]);